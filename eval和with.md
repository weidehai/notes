## 欺骗（修改，泄露）词法作用域

一个重要的前提：

引擎并不“知道”或“在意”eval和with代码中的词法作用域，也就是说js引擎不会去特意静态检查eval对词法作用域造成的影响，而是在遇到eval时放弃所有的静态优化

![image-20210519205354559](https://i.loli.net/2021/05/19/5U6iHcPYAFeZK7y.png)

在严格模式的程序中，eval(…) 在运行时有其自己的词法作用域，无法修改所在的作用域。

按理来说如果没有eval的话，在引擎静态分析词法作用域的时候就可以确定下来b的位置，就是全局变量的b，但是如果有eval语句，在非严格模式下，eval执行语句的过程如果遇到找不到的变量，就会到eval所在的词法作用域中找，一直找到顶级词法作用域，如果都找不到，就会在顶级词法作用域创建变量，就会造成词法作用域的变化，而这种意外的变化，浏览器不会提前检查出来（目前是这样。可能以后会优化引擎），那么之前静态分析所作的优化都不存在了（也就是浏览器在遇到eval语句的时候就废弃掉所有的静态优化，而是在运行期间查找，会降低性能）

同理with也是这样

![image-20210519212932935](https://i.loli.net/2021/05/19/OlnSidEvTPF2gta.png)

